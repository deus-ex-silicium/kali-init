- name: download firefox archive
  become: true
  unarchive:
    src: https://download.mozilla.org/?product=firefox-latest-ssl&os=linux64&lang=en-US
    dest: /usr/local/bin/firefox/

- name: find default firefox profile path
  command: find ~/.mozilla/firefox/ -name '*.default'
  register: ffp

- name: create firefox extensions directory
  file: path="{{ ffp.stdout }}/extensions/" state=directory

- name: download uBlock Origin extension
  get_url:
    url: https://addons.mozilla.org/firefox/downloads/file/3521827/ublock_origin-1.25.2-an+fx.xpi
    dest: "{{ ffp.stdout }}/extensions/uBlock0@raymondhill.net.xpi"
    mode: 0600

- name: download Privacy Badger extension
  get_url:
    url: https://addons.mozilla.org/firefox/downloads/file/3509922/privacy_badger-2020.2.19-an+fx.xpi
    dest: "{{ ffp.stdout }}/extensions/jid1-MnnxcxisBPnSXQ@jetpack.xpi"
    mode: 0600

- name: download Tree Style Tabs extension
  get_url:
    url: https://addons.mozilla.org/firefox/downloads/file/3528257/tree_style_tab_-3.4.7-fx.xpi
    dest: "{{ ffp.stdout }}/extensions/treestyletab@piro.sakura.ne.jp.xpi"
    mode: 0600
    
- name: download FoxyProxy extension
  get_url:
    url: https://addons.mozilla.org/firefox/downloads/file/3476518/foxyproxy_standard-7.4.3-an+fx.xpi
    dest: "{{ ffp.stdout }}/extensions/foxyproxy@eric.h.jung.xpi"
    mode: 0600

- name: Create firefox chrome directory
  file: path="{{ ffp.stdout }}/chrome/" state=directory

- name: Copy firefox TST style
  copy: src=userChrome.css dest="{{ ffp.stdout }}/chrome/"

- name: Copy firefox user preferences
  copy: src=user.js dest="{{ ffp.stdout }}"

# https://stackoverflow.com/questions/37728865/install-webextensions-on-firefox-from-the-command-line
# https://gist.github.com/0XDE57/fbd302cef7693e62c769
